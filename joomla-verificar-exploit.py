# -*- coding: utf-8 -*-

import requests

#faz o filtro de uma palavra inserida dentro de uma string
def get_string(variavel,inicio,fim):
	variavel_array_primario = variavel.split(inicio)
	variavel_array_secundario = variavel_array_primario[1].split(fim)
	resultado = variavel_array_secundario[0]
	return resultado

#verifica se a versao do joomla eh vulneravel
def is_version_vulnerable(versao_joomla_array):

	#converte todos os elementos da lista em int
	for i in range(0, len(versao_joomla_array)): 
		versao_joomla_array[i] = int(versao_joomla_array[i]) 

	#verifica se a versao do joomla esta dentro da faixa de versoes vulneraveis (1.5.0 ate 3.4.5)
	if(versao_joomla_array[0] >= 1) and (versao_joomla_array[0] <= 3):
		#print('ok')
		if(versao_joomla_array[1] >= 0) and (versao_joomla_array[1] <= 4):
			#print('ok')
			if(versao_joomla_array[2] >= 0) and (versao_joomla_array[2] <= 5):
				#print('ok')
				return True

	else:
		#print('[+]joomla seguro pois esta atualizado')
		return False

total_alvos = sum(1 for linha in open("possiveis-alvos-joomla.txt", "r"))
#calcula a quantidade de alvo no arquivo

contador = 0

with open('possiveis-alvos-joomla.txt', 'r') as f:
	for linha in f.read().splitlines():

		print('\n' + str(contador) + '/' + str(total_alvos))
		print(linha)
		contador = contador + 1	

		try:
			url_alvo = "http://" + linha + "/administrator/manifests/files/joomla.xml"
			url_alvo_response = requests.get(url_alvo, timeout=15)

			versao_joomla = get_string(url_alvo_response.text,"<version>","</version>")
			versao_joomla_array = versao_joomla.split('.')

			if(is_version_vulnerable(versao_joomla_array) == True):
				print(url_alvo)
				print('[+]este servidor utiliza uma versao do joomla vulneravel a remote command execution (RCE)')
				print('[+]material de referencia: https://www.exploit-db.com/exploits/38977 e https://blog.sucuri.net/2015/12/joomla-remote-code-execution-the-details.html')

			else:
				print('[+]essa versao do joomla nao esta vulneravel [' + versao_joomla + ']')

		except:
			print('[+]FALHA (servidor alvo provalvemnte nao eh joomla')
